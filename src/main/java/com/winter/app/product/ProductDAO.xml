<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.winter.app.product.ProductDAO">
    
     <sql id="search">
   		 <if test="kind == 'k1'">
			WHERE board_title LIKE concat('%', #{search}, '%')
		</if>
		<if test="kind == 'k2'">
			WHERE board_contents LIKE concat('%', #{search}, '%')
		</if>
		<if test="kind == 'k3'">
			WHERE board_writer LIKE concat('%', #{search}, '%')
		</if>
    </sql>
    <!-- 목록 -->
    <select id="list" resultType="ProductDTO" parameterType="ProductDTO">
    	SELECT * FROM products
    	<include refid="search"></include>
    	ORDER BY products_num DESC
		LIMIT #{startNum}, #{perPage}
    </select>

	<!-- 상세 -->
    <select id="detail" resultType="ProductDTO" parameterType="ProductDTO">
    	SELECT * FROM products WHERE products_num=#{productsNum}
    </select>
	
		
	<!-- 추가 -->    
    <insert id="add" parameterType="ProductDTO">
    	INSERT INTO products (products_name, products_contents, products_category, products_rate, products_sale) VALUES (#{productsName}, #{productsContents}, #{productsCategory}, #{productsRate}, #{productsSale})
    </insert>
    
    <!-- 수정 -->
    <update id="update" parameterType="ProductDTO">
    	UPDATE products SET products_name=#{productsName}, products_contents=#{productsContents}, products_category=#{productsCategory}, products_rate=#{productsRate}, products_sale=#{productsSale} WHERE products_num=#{productsNum}
    </update>
    
    <!-- 삭제 -->
    <update id="delete" parameterType="ProductDTO">
    	UPDATE products SET products_sale=1 WHERE products_num=#{productsNum}
    
    </update>
    
    <select id="count" resultType="Long">
		SELECT count(products_num)
		FROM products	
		<include refid="search"></include>
	</select>
    
    
    </mapper>