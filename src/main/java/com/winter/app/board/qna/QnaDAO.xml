<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.winter.app.board.qna.QnaDAO">
    <sql id="search">
   		 <if test="kind == 'k1'">
			WHERE board_title LIKE concat('%', #{search}, '%')
		</if>
		<if test="kind == 'k2'">
			WHERE board_contents LIKE concat('%', #{search}, '%')
		</if>
		<if test="kind == 'k3'">
			WHERE board_writer LIKE concat('%', #{search}, '%')
		</if>
    </sql>
    <select id="list" resultType="com.winter.app.board.qna.QnaDTO">
        SELECT * FROM qna
        <include refid="search"></include>
         ORDER BY board_ref DESC, board_step ASC
         LIMIT #{startNum}, #{perPage}
    </select>
    
    <select id="count" resultType="Long">
		SELECT count(board_num)
		FROM qna	
		<include refid="search"></include>
	</select>
    
    <insert id="add" parameterType="com.winter.app.board.qna.QnaDTO" useGeneratedKeys="true" keyProperty="boardNum">
        INSERT INTO qna (board_title, board_writer, board_contents, board_date, board_hit, board_ref, board_step, board_depth)
        VALUES (#{boardTitle}, #{boardWriter}, #{boardContents}, now(), 0, #{boardRef}, #{boardStep}, #{boardDepth})
    </insert>
    
    <update id="refUpdate" parameterType="QnaDTO">
    	UPDATE qna SET board_ref=#{boardNum} WHERE board_num=#{boardNum}
    </update>
    
    <select id="detail" resultType="qnaDTO">
    	SELECT * FROM qna WHERE board_num=#{boardNum}
    </select>
    
    <update id="stepUpdate" parameterType="QnaDTO">
    	UPDATE qna SET board_step=board_step+1 WHERE board_ref = #{boardRef} AND board_step > #{boardStep} 
    </update>
    
    <update id="update" parameterType="QnaDTO">
    	UPDATE qna SET board_title=#{boardTitle}, board_contents=#{boardContents} WHERE board_num=#{boardNum}
    </update>
    
    <!-- <insert id="stepInsert" parameterType="QnaDTO" useGeneratedKeys="true" keyProperty="boardNum">
        INSERT INTO qna (board_title, board_writer, board_contents, board_date, board_hit, board_ref, board_step, board_depth)
        VALUES (#{boardTitle}, #{boardWriter}, #{boardContents}, now(), 0, #{boardRef}, #{boardStep}, #{boardDepth})
    	
    </insert>-->
    <delete id="delete" parameterType="QnaDTO">
		DELETE FROM qna WHERE board_num=#{boardNum}
	</delete>
    </mapper>